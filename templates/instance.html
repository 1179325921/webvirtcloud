{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Instance" %} - {{ vname }}{% endblock %}
{% block content %}
                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">{{ vname }}</h1>
                    </div>
                    <h4 class="page-header">
                        {% trans "Status:" %}
                        {% ifequal status 5 %}
                           <span class="text-danger">{% trans "Off" %}</span>
                        {% endifequal %}
                        {% ifequal status 1 %}
                            <span class="text-success">{% trans "Active" %}</span>
                        {% endifequal %}
                        {% ifequal status 3 %}
                            <span class="text-warning">{% trans "Suspend" %}</span>
                        {% endifequal %}
                        {% trans "Vcpu:" %}
                        {% if cur_vcpu %}{{ cur_vcpu }}{% else %}{{ vcpu }}{% endif %}
                        {% trans "Ram:" %}
                        {{ cur_memory }}{% trans "MB" %}
                        {% trans "Disk:" %}
                        {% for disk in disks %}
                           {{ disk.size|filesizeformat }}
                        {% endfor %}
                    </h4>
                </div>
                <!-- /.row -->

                {% include 'errors_block.html' %}

                <div class="row" id="max-width-page">
                    <div class="col-lg-12">
                        <div role="tabpanel">
                            <!-- Nav tabs -->
                            <ul class="nav nav-pills" role="tablist">
                                <li role="presentation" class="active">
                                    <a href="#power" id="action-button" aria-controls="power" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-off" aria-hidden="true"></span>
                                        {% trans "Power" %}
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a href="#access" id="action-button" aria-controls="access" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                                        {% trans "Access" %}
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a href="#resize" id="action-button" aria-controls="resize" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-resize-full" aria-hidden="true"></span>
                                        {% trans "Resize" %}
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a href="#snapshots" id="action-button" aria-controls="snapshots" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-camera" aria-hidden="true"></span>
                                        {% trans "Snapshots" %}
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a href="#settings" id="action-button" aria-controls="settings" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                                        {% trans "Settings" %}
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a href="#graphics" id="action-button" aria-controls="graphics" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-signal" aria-hidden="true"></span>
                                        {% trans "Graphs" %}
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a href="#undefine" id="action-button" aria-controls="undefine" role="tab" data-toggle="tab">
                                        <span id="action-block" class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        {% trans "Destroy" %}
                                    </a>
                                </li>
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="power">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            {% ifequal status 1 %}
                                                <li role="presentation" class="active">
                                                    <a href="#powercycle" aria-controls="powercycle" role="tab" data-toggle="tab">
                                                        {% trans "Power Cycle" %}
                                                    </a>
                                                </li>
                                                <li role="presentation">
                                                    <a href="#poweroff" aria-controls="poweroff" role="tab" data-toggle="tab">
                                                        {% trans "Power Off" %}
                                                    </a>
                                                </li>
                                                {% if request.user.is_superuser %}
                                                    <li role="presentation">
                                                        <a href="#suspend" aria-controls="suspend" role="tab" data-toggle="tab">
                                                            {% trans "Suspend" %}
                                                        </a>
                                                    </li>
                                                {% endif %}
                                            {% endifequal %}
                                            {% if request.user.is_superuser %}
                                                {% ifequal status 3 %}
                                                    <li role="presentation" class="active">
                                                        <a href="#resume" aria-controls="resume" role="tab" data-toggle="tab">
                                                            {% trans "Resume" %}
                                                        </a>
                                                    </li>
                                                {% endifequal %}
                                            {% endif %}
                                            {% ifequal status 5 %}
                                                <li role="presentation" class="active">
                                                    <a href="#boot" aria-controls="boot" role="tab" data-toggle="tab">
                                                        {% trans "Power On" %}
                                                    </a>
                                                </li>
                                            {% endifequal %}
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            {% ifequal status 1 %}
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="powercycle">
                                                    <p>{% trans "This action forcibly powers off the instance and may cause data corruption." %}</p>
                                                    <form action="" method="post" role="form">{% csrf_token %}
                                                        <input type="submit" name="powercycle" class="btn btn-lg btn-success pull-right" value="{% trans "Power Cycle" %}">
                                                        <div class="clearfix"></div>
                                                    </form>
                                                </div>
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered" id="poweroff">
                                                    <p>{% trans "This action sends an ACPI shutdown signal to the instance." %}</p>
                                                     <form action="" method="post" role="form">{% csrf_token %}
                                                        <input type="submit" name="poweroff" class="btn btn-lg btn-success pull-right" value="{% trans "Power Off" %}">
                                                        <div class="clearfix"></div>
                                                    </form>
                                                </div>
                                                {% if request.user.is_superuser %}
                                                    <div role="tabpanel" class="tab-pane tab-pane-bordered" id="suspend">
                                                        <p>{% trans "This action suspends the instance." %}</p>
                                                         <form action="" method="post" role="form">{% csrf_token %}
                                                            <input type="submit" name="suspend" class="btn btn-lg btn-success pull-right" value="{% trans "Suspend" %}">
                                                            <div class="clearfix"></div>
                                                        </form>
                                                    </div>
                                                {% endif %}
                                            {% endifequal %}
                                            {% if request.user.is_superuser %}
                                                {% ifequal status 3 %}
                                                    <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="resume">
                                                        <p>{% trans "This action restore the instance after suspend." %}</p>
                                                         <form action="" method="post" role="form">{% csrf_token %}
                                                            <input type="submit" name="resume" class="btn btn-lg btn-success pull-right" value="{% trans "Resume" %}">
                                                            <div class="clearfix"></div>
                                                        </form>
                                                    </div>
                                                {% endifequal %}
                                            {% endif %}
                                            {% ifequal status 5 %}
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="boot">
                                                    <p>{% trans "Click on Boot button to start this instance." %}</p>
                                                    <form action="" method="post" role="form">{% csrf_token %}
                                                        <input type="submit" name="poweron" class="btn btn-lg btn-success pull-right" value="{% trans "Power On" %}">
                                                        <div class="clearfix"></div>
                                                    </form>
                                                </div>
                                            {% endifequal %}
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="access">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            <li role="presentation" class="active">
                                                <a href="#vnconsole" aria-controls="vnconsole" role="tab" data-toggle="tab">
                                                    {% trans "Console" %}
                                                </a>
                                            </li>
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="vnconsole">
                                                <p>{% trans "This action opens a new window with a VNC connection to the console of the instance." %}</p>
                                                {% ifequal status 5 %}
                                                    <button class="btn btn-lg btn-success pull-right disabled">{% trans "Console" %}</button>
                                                {% else %}
                                                    <a href="#" class="btn btn-lg btn-success pull-right" title="Console port: {{ console_port }}" onclick="open_console()">{% trans "Console" %}</a>
                                                {% endifequal %}
                                                <div class="clearfix"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="resize">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            <li role="presentation" class="active">
                                                <a href="#resizevm" aria-controls="resizevm" role="tab" data-toggle="tab">
                                                    {% trans "Resize Instance" %}
                                                </a>
                                            </li>
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="resizevm">
                                                {% if request.user.is_superuser or userinstace.is_change %}
                                                    <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                                        <p style="font-weight:bold;">{% trans "Logical host CPUs:" %} {{ vcpu_host }}</p>
                                                        <div class="form-group">
                                                            <label class="col-sm-4 control-label" style="font-weight:normal;"> {% trans "Current allocation" %}</label>
                                                            <div class="col-sm-4">
                                                                <select name="cur_vcpu" class="form-control">
                                                                    {% for cpu in vcpu_range %}
                                                                        {% if cur_vcpu %}
                                                                            <option value="{{ cpu }}" {% if cpu == cur_vcpu %}selected{% endif %}>{{ cpu }}</option>
                                                                        {% else %}
                                                                            <option value="{{ cpu }}" {% if cpu == vcpu %}selected{% endif %}>{{ cpu }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-4 control-label" style="font-weight:normal;">{% trans "Maximum allocation" %}</label>
                                                            <div class="col-sm-4">
                                                                <select name="vcpu" class="form-control">
                                                                    {% for cpu in vcpu_range %}
                                                                        <option value="{{ cpu }}" {% if cpu == vcpu %}selected{% endif %}>{{ cpu }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <p style="font-weight:bold;">{% trans "Total host memory:" %} {{ memory_host|filesizeformat }}</p>
                                                        <div class="form-group">
                                                            <label class="col-sm-4 control-label" style="font-weight:normal;">{% trans "Current allocation" %} ({% trans "MB" %})</label>
                                                            <div class="col-sm-4 js-custom__container">
                                                                <select name="cur_memory" class="form-control js-custom__toggle">
                                                                    {% for mem in memory_range %}
                                                                        <option value="{{ mem }}"
                                                                                {% if mem == cur_memory %}selected{% endif %}>{{ mem }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <input type="text" name="cur_memory_custom" class="form-control js-custom__toggle" style="display: none" />
                                                                <small><input type="checkbox" class="js-custom__checkbox" /> {% trans "Custom value" %}</small>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-4 control-label"
                                                                   style="font-weight:normal;">{% trans "Maximum allocation" %} ({% trans "MB" %})</label>

                                                            <div class="col-sm-4 js-custom__container">
                                                                <select name="memory" class="form-control js-custom__toggle">
                                                                    {% for mem in memory_range %}
                                                                        <option value="{{ mem }}"
                                                                                {% if mem == memory %}selected{% endif %}>{{ mem }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <input type="text" name="memory_custom" class="form-control js-custom__toggle" style="display: none" />
                                                                <small><input type="checkbox" class="js-custom__checkbox" /> {% trans "Custom value" %}</small>
                                                            </div>
                                                        </div>
                                                        {% ifequal status 5 %}
                                                            <button type="submit" class="btn btn-lg btn-success pull-right" name="resize">{% trans "Resize" %}</button>
                                                        {% else %}
                                                            <button class="btn btn-lg btn-success pull-right disabled">{% trans "Resize" %}</button>
                                                        {% endifequal %}
                                                    </form>
                                                {% else %}
                                                    {% trans "You don't have permission for resizing instance" %}
                                                    <button class="btn btn-lg btn-success pull-right disabled">{% trans "Resize" %}</button>
                                                {% endif %}
                                                <div class="clearfix"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="snapshots">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            <li role="presentation" class="active">
                                                <a href="#takesnapshot" aria-controls="takesnapshot" role="tab" data-toggle="tab">
                                                    {% trans "Take Snapshot" %}
                                                </a>
                                            </li>
                                            <li role="presentation">
                                                <a href="#restoresnapshot" aria-controls="restoresnapshot" role="tab" data-toggle="tab">
                                                    {% trans "Restore From Snapshot" %}
                                                </a>
                                            </li>
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="takesnapshot">
                                                {% ifequal status 5 %}
                                                    <p>{% trans "This may take more than an hour, depending on how much content is on your droplet and how large the disk is." %}</p>
                                                    <form class="form-inline" method="post" role="form">{% csrf_token %}
                                                        <div class="form-group">
                                                            <div class="col-sm-6">
                                                                <input type="text" class="form-control input-lg" name="name" placeholder="{% trans "Enter Snapshot Name" %}" maxlength="14">
                                                            </div>
                                                        </div>
                                                        {% ifequal status 5 %}
                                                            <input type="submit" class="btn btn-lg btn-success pull-right" name="snapshot" value="{% trans "Take Snapshot" %}">
                                                        {% else %}
                                                            <button class="btn btn-lg btn-success pull-right disabled">{% trans "Take Snapshot" %}</button>
                                                        {% endifequal %}
                                                    </form>
                                                    <div class="clearfix"></div>
                                                {% else %}
                                                    <p>{% trans "To take a snapshot please Power Off the instance." %}</p>
                                                {% endifequal %}
                                            </div>
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered" id="restoresnapshot">
                                               {% ifequal status 5 %}
                                                    {% if snapshots %}
                                                        <p>{% trans "Choose a snapshot for restore" %}</p>
                                                        <div class="table-responsive">
                                                            <table class="table">
                                                                <thead>
                                                                <tr>
                                                                    <th>{% trans "Name" %}</th>
                                                                    <th>{% trans "Date" %}</th>
                                                                    <th colspan="2">{% trans "Action" %}</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                {% for snap in snapshots %}
                                                                    <tr>
                                                                        <td><strong>{{ snap.name }}</strong></td>
                                                                        <td>{{ snap.date|date:"M d H:i:s" }}</td>
                                                                        <td style="width:30px;">
                                                                            <form action="" method="post" style="height:10px" role="form">{% csrf_token %}
                                                                                <input type="hidden" name="name" value="{{ snap.name }}">
                                                                                {% ifequal status 5 %}
                                                                                    <button type="submit" class="btn btn-sm btn-default" name="revert_snapshot" onclick="return confirm('Are you sure?')">
                                                                                        <span class="glyphicon glyphicon-save"></span>
                                                                                    </button>
                                                                                {% else %}
                                                                                    <button type="button" class="btn btn-sm btn-default disabled">
                                                                                        <span class="glyphicon glyphicon-save"></span>
                                                                                    </button>
                                                                                {% endifequal %}
                                                                            </form>
                                                                        </td>
                                                                        <td style="width:30px;">
                                                                            <form action="" method="post" role="form">{% csrf_token %}
                                                                                <input type="hidden" name="name" value="{{ snap.name }}">
                                                                                <button type="submit" class="btn btn-sm btn-default" name="delete_snapshot" onclick="return confirm('{% trans "Are you sure?" %}')">
                                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                                </button>
                                                                            </form>
                                                                        </td>
                                                                    </tr>
                                                                {% endfor %}
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    {% else %}
                                                        <p>{% trans "You do not have any snapshots" %}</p>
                                                    {% endif %}
                                                {% else %}
                                                    <p>{% trans "To restore snapshots you need Power Off the instance." %}</p>
                                                {% endifequal %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="settings">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            <li role="presentation" class="active">
                                                <a href="#media" aria-controls="media" role="tab" data-toggle="tab">
                                                    {% trans "Media" %}
                                                </a>
                                            </li>
                                            {% if request.user.is_superuser %}
                                                <li role="presentation">
                                                    <a href="#autostart" aria-controls="autostart" role="tab" data-toggle="tab">
                                                        {% trans "Autostart" %}
                                                    </a>
                                                </li>
                                                <li role="presentation">
                                                    <a href="#vncsettings" aria-controls="vncsettings" role="tab" data-toggle="tab">
                                                        {% trans "VNC" %}
                                                    </a>
                                                </li>
                                                <li role="presentation">
                                                    <a href="#clone" aria-controls="clone" role="tab" data-toggle="tab">
                                                        {% trans "Clone" %}
                                                    </a>
                                                </li>
                                                <li role="presentation">
                                                    <a href="#migrate" aria-controls="migrate" role="tab" data-toggle="tab">
                                                        {% trans "Migrate" %}
                                                    </a>
                                                </li>
                                                <li role="presentation">
                                                    <a href="#xmledit" aria-controls="xmledit" role="tab" data-toggle="tab">
                                                        {% trans "XML" %}
                                                    </a>
                                                </li>
                                            {% endif %}
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="media">
                                                <form class="form-horizontal" action="" method="post" role="form">{% csrf_token %}
                                                    {% for cd in media %}
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">{% trans "CDROM" %} {{ forloop.counter }}</label>
                                                            {% if not cd.image %}
                                                                <div class="col-sm-6">
                                                                    <select name="media" class="form-control">
                                                                        {% if media_iso %}
                                                                            {% for iso in media_iso %}
                                                                                <option value="{{ iso }}">{{ iso }}</option>
                                                                            {% endfor %}
                                                                        {% else %}
                                                                            <option value="none">{% trans "None" %}</option>
                                                                        {% endif %}
                                                                    </select>
                                                                </div>
                                                                <div class="col-sm-2">
                                                                    {% if media_iso %}
                                                                        <button type="submit" class="btn btn-sm btn-success pull-left" name="mount_iso" value="{{ cd.dev }}" style="margin-top: 2px;">{% trans "Mount" %}</button>
                                                                    {% else %}
                                                                        <button class="btn btn-sm btn-success pull-left disabled" name="mount_iso" style="margin-top: 2px;">{% trans "Mount" %}</button>
                                                                    {% endif %}
                                                                </div>
                                                            {% else %}
                                                                <div class="col-sm-5">
                                                                    <p>{{ cd.image }}</p>
                                                                </div>
                                                                <div class="col-sm-2">
                                                                    <input type="hidden" name="path" value="{{ cd.path }}">
                                                                    <button type="submit" class="btn btn-sm btn-success pull-left" value="{{ cd.dev }}" name="umount_iso" style="margin-top: 2px;">{% trans "Umount" %}</button>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                    {% endfor %}
                                                </form>
                                                <div class="clearfix"></div>
                                            </div>
                                            {% if request.user.is_superuser %}
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered" id="autostart">
                                                    <p>{% trans "Autostart your instance when host server is power on" %}</p>
                                                    <form class="form-horizontal" action="" method="post" role="form">{% csrf_token %}
                                                        {% ifequal autostart 0 %}
                                                            <input type="submit" class="btn btn-lg btn-success pull-right" name="set_autostart" value="{% trans "Enable" %}">
                                                        {% else %}
                                                            <input type="submit" class="btn btn-lg btn-success pull-right" name="unset_autostart" value="{% trans "Disable" %}">
                                                        {% endifequal %}
                                                    </form>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered" id="vncsettings">
                                                    <p>{% trans "To set console's type, shutdown the instance." %}</p>
                                                    <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                                        <div class="form-group" id="console_type_selection">
                                                            <label for="console_select_type" class="col-sm-2 control-label">{% trans "Type" %}</label>
                                                            <div class="col-sm-6">
                                                                <select id="console_select_type" class="form-control" name="console_type">
                                                                    <option value="" style="font-weight: bold">{% trans "please choose" %}</option>
                                                                    {% for ctype in console_types %}
                                                                        <option value="{{ ctype }}">{{ ctype }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="col-sm-3">
                                                                {% ifequal status 5 %}
                                                                    <button type="submit" class="btn btn-success " name="set_console_type">{% trans "Set" %}</button>
                                                                {% else %}
                                                                    <button class="btn btn-success disabled" name="set_console_type">{% trans "Set" %}</button>
                                                                {% endifequal %}
                                                            </div>
                                                        </div>
                                                    </form>
                                                    <p>{% trans "To create console password, shutdown the instance." %}</p>
                                                    <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                                        <div class="form-group">
                                                            <div class="col-sm-offset-2 col-sm-10">
                                                                <div class="checkbox">
                                                                    <label>
                                                                        <input type="checkbox" name="auto_pass" value="true" id="console_passwd_gen">{% trans "Generate" %}
                                                                    </label>
                                                                </div>
                                                                <div class="checkbox">
                                                                    <label>
                                                                        <input type="checkbox" name="clear_pass" value="true" id="console_passwd_clear">{% trans "Clear" %}
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group" id="console_passwd_manual">
                                                            <label for="inputPassword1" class="col-sm-2 control-label">{% trans "Password" %}</label>
                                                            <div class="col-sm-6">
                                                                <input id="console_show_pass" type="password" class="form-control" name="console_passwd"
                                                                       {% if console_passwd %}
                                                                            value="{{ console_passwd }}"
                                                                       {% else %}
                                                                            placeholder="{% trans "Password" %}"
                                                                       {% endif %} maxlength="14">
                                                            </div>
                                                            {% if console_passwd %}
                                                                <a href="#" name="console_show" class="btn btn-primary btn-md" onclick="show_console()">{% trans "Show" %}</a>
                                                            {% endif %}
                                                            <div class="col-sm-3">
                                                                {% ifequal status 5 %}
                                                                    <button type="submit" class="btn btn-success" name="set_console_passwd">{% trans "Set" %}</button>
                                                                {% else %}
                                                                    <button class="btn btn-success disabled" name="set_console_passwd">{% trans "Set" %}</button>
                                                                {% endifequal %}
                                                            </div>
                                                        </div>
                                                    </form>
                                                    <p>{% trans "To set console's keymap, shutdown the instance." %}</p>
                                                    <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                                        <div class="form-group">
                                                            <div class="col-sm-offset-2 col-sm-10">
                                                                <div class="checkbox">
                                                                    <label>
                                                                        <input type="checkbox" name="clear_keymap" value="true" id="console_keymap_clear">{% trans "Clear" %}
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group" id="console_keymap_selection">
                                                            <label for="console_select_keymap" class="col-sm-2 control-label">{% trans "Keymap" %}</label>
                                                            <div class="col-sm-6">
                                                                <select id="console_select_keymap" class="form-control" name="console_keymap">
                                                                    <option value="" style="font-weight: bold">{% trans "please choose" %}</option>
                                                                    {% for keymap in keymaps %}
                                                                        <option value="{{ keymap }}">{{ keymap }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="col-sm-3">
                                                                {% ifequal status 5 %}
                                                                    <button type="submit" class="btn btn-success" name="set_console_keymap">{% trans "Set" %}</button>
                                                                {% else %}
                                                                    <button class="btn btn-success disabled" name="set_console_keymap">{% trans "Set" %}</button>
                                                                {% endifequal %}
                                                            </div>
                                                        </div>
                                                    </form>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered" id="clone">
                                                    <p style="font-weight:bold;">{% trans "Create a clone" %}</p>
                                                    <form class="form-horizontal" action="" method="post" role="form">{% csrf_token %}
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label" style="font-weight:normal;">{% trans "Clone Name" %}</label>
                                                            <div class="col-sm-3">
                                                                <input type="text" class="form-control" name="name" value="{{ vname }}-clone"/>
                                                            </div>
                                                        </div>
                                                        <p style="font-weight:bold;">{% trans "Network devices" %}</p>
                                                        {% for network in networks %}
                                                            <div class="form-group">
                                                                <label class="col-sm-3 control-label" style="font-weight:normal;">eth{{ forloop.counter0 }} ({{ network.nic }})</label>
                                                                <div class="col-sm-3">
                                                                    <input type="text" class="form-control" name="net-{{ forloop.counter0 }}" value="{{ network.mac }}"/>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button type="button" class="btn btn-sm btn-success pull-left" name="random-mac-{{ forloop.counter0 }}"
                                                                            onclick="random_mac({{ forloop.counter0 }})" style="margin-top: 2px;">{% trans "Random" %}</button>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                        <p style="font-weight:bold;">{% trans "Storage devices" %}</p>
                                                        {% for disk in clone_disks %}
                                                            <div class="form-group">
                                                                <label class="col-sm-3 control-label" style="font-weight:normal;">{{ disk.dev }} ({{ disk.storage }})</label>
                                                                <div class="col-sm-3">
                                                                    <input type="text" class="form-control" name="disk-{{ disk.dev }}" value="{{ disk.image }}"/>
                                                                </div>
                                                                {% ifequal disk.format 'qcow2' %}
                                                                    <label class="col-sm-2 control-label" style="font-weight:normal;margin-left:-35px;">Metadata</label>
                                                                    <div class="col-sm-1">
                                                                        <input type="checkbox" name="meta-{{ disk.dev }}" value="true" style="margin-top: 10px;">
                                                                    </div>
                                                                {% endifequal %}
                                                            </div>
                                                        {% endfor %}
                                                        {% ifequal status 5 %}
                                                            <button type="submit" class="btn btn-lg btn-success pull-right" name="clone">{% trans "Clone" %}</button>
                                                        {% else %}
                                                            <button class="btn btn-lg btn-success pull-right disabled" name="clone">{% trans "Clone" %}</button>
                                                        {% endifequal %}
                                                    </form>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered" id="migrate">
                                                    <p>{% trans "For migration both host servers must have equal settings and OS type" %}</p>
                                                    <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{% trans "Original host" %}</label>
                                                            <div class="col-sm-6">
                                                                <p style="margin: 10px -10px 0 0;">{{ compute.name }}</p>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{% trans "Host migration" %}</label>
                                                            <div class="col-sm-6">
                                                                <select name="compute_id" class="form-control">
                                                                    {% if computes_count != 1 %}
                                                                        {% for comp in computes %}
                                                                            {% if comp.id != compute.id %}
                                                                                <option value="{{ comp.id }}">{{ comp.name }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    {% endif %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{% trans "Live migration" %}</label>
                                                            <div class="col-sm-6">
                                                                <input type="checkbox" name="live_migrate" value="true" id="vm_live_migrate">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{% trans "Unsafe migration" %}</label>
                                                            <div class="col-sm-6">
                                                                <input type="checkbox" name="unsafe_migrate" value="true" id="vm_unsafe_migrate">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">{% trans "Delete original" %}</label>
                                                            <div class="col-sm-6">
                                                                <input type="checkbox" name="xml_delete" value="true" id="xml_delete">
                                                            </div>
                                                        </div>
                                                        {% if computes_count != 1 %}
                                                            <button type="submit" class="btn btn-lg btn-success pull-right" name="migrate">{% trans "Migrate" %}</button>
                                                        {% else %}
                                                            <button class="btn btn-lg btn-success pull-right disabled">{% trans "Migrate" %}</button>
                                                        {% endif %}
                                                    </form>
                                                    <div class="clearfix"></div></p>
                                                </div>
                                                <div role="tabpanel" class="tab-pane tab-pane-bordered" id="xmledit">
                                                    <p>{% trans "If you need to edit xml please Power Off the instance" %}</p>
                                                    <form class="form-horizontal" method="post" role="form">{% csrf_token %}
                                                        <div class="col-sm-12" id="xmlheight">
                                                            <textarea id="editor">{{ inst_xml }}</textarea>
                                                        </div>
                                                        {% ifequal status 5 %}
                                                            <input type="hidden" name="inst_xml">
                                                            <button type="submit" class="btn btn-lg btn-success pull-right" name="change_xml">
                                                                {% trans "Change" %}
                                                            </button>
                                                        {% else %}
                                                            <button class="btn btn-lg btn-success pull-right disabled">
                                                                {% trans "Change" %}
                                                            </button>
                                                        {% endifequal %}
                                                    </form>
                                                    <div class="clearfix"></div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="graphics">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            <li role="presentation" class="active">
                                                <a href="#graps" aria-controls="graps" role="tab" data-toggle="tab">
                                                    {% trans "Real Time" %}
                                                </a>
                                            </li>
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="graps">
                                                <p>Graphics</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="undefine">
                                    <div role="tabpanel">
                                        <!-- Nav tabs -->
                                        <ul class="nav nav-tabs" role="tablist">
                                            <li role="presentation" class="active">
                                                <a href="#destroy" aria-controls="destroy" role="tab" data-toggle="tab">
                                                    {% trans "Destroy Instance" %}
                                                </a>
                                            </li>
                                        </ul>
                                        <!-- Tab panes -->
                                        <div class="tab-content">
                                            <div role="tabpanel" class="tab-pane tab-pane-bordered active" id="destroy">
                                                <p>{% trans "Delete storage for instance?" %}</p>
                                                {% if request.user.is_superuser or userinstace.is_delete %}
                                                    <form class="form-group" method="post" role="form">{% csrf_token %}
                                                        <div class="checkbox" style="margin-left: 8px;">
                                                            <label>
                                                                <input type="checkbox" name="delete_disk" value="true">
                                                                <strong>{% trans "Remove Instance's data" %}</strong>
                                                            </label>
                                                        </div>
                                                        <button type="submit" class="btn btn-lg btn-success pull-right" name="delete">{% trans "Destroy" %}</button>
                                                    </form>
                                                {% else %}
                                                    <button class="btn btn-lg btn-success disabled pull-right" name="delete">{% trans "Destroy" %}</button>
                                                {% endif %}
                                                <div class="clearfix"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
{% endblock %}
{% block script %}
<script src="{{ STATIC_URL }}/js/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.getSession().setMode("ace/mode/xml");

    var input = $('input[name="inst_xml"]');
        editor.getSession().on("change", function () {
        input.val(editor.getSession().getValue());
    });
</script>
<script>
    function open_console() {
        window.open('{% url 'console' %}?token={{ compute_id }}-{{ uuid }}', '', 'width=850,height=485')
    }
</script>
<script>
    function random_mac(net) {
        var hexDigits = "0123456789abcdef";
        var macAddress="52:54:00:";
        for (var i=0; i<3; i++) {
            macAddress+=hexDigits.charAt(Math.round(Math.random()*16));
            macAddress+=hexDigits.charAt(Math.round(Math.random()*16));
            if (i != 2) macAddress+=":";
        }
        $('input[name="net-'+net+'"]').val(macAddress);
    };
</script>
<script>
    function show_console() {
        if ($('#console_show_pass').attr('type') == 'password') {
            $('#console_show_pass').attr('type', 'text');
        } else {
            $('#console_show_pass').attr('type', 'password');
        }
    }
</script>
<script>
    $(document).on('change', '#console_passwd_gen', function () {
        if ($(this).prop('checked')) {
            $('#console_passwd_manual').hide();
            $('#console_passwd_clear').prop('checked', false);
        } else {
            $('#console_passwd_manual').show();
        }
    });
    $(document).on('change', '#console_passwd_clear', function () {
        if ($(this).prop('checked')) {
            $('#console_passwd_manual').hide();
            $('#console_passwd_gen').prop('checked', false);
        } else {
            $('#console_passwd_manual').show();
        }
    });
    $(document).on('change', '#console_keymap_clear', function () {
        if ($(this).prop('checked')) {
            $('#console_keymap_selection').hide();
        } else {
            $('#console_keymap_selection').show();
        }
    });
    $(document).ready(function () {
        // set current console keymap or fall back to default
        var keymap = "{{ console_keymap }}"
        if (keymap != '') {
            $("#console_select_keymap option[value='" + keymap + "']").prop('selected', true);
        }
    });
    $(document).ready(function () {
        // set current console type or fall back to default
        var console_type = "{{ console_type }}"
        if (console_type != '') {
            $("#console_select_type option[value='" + console_type + "']").prop('selected', true);
        }
    });
</script>
<script>
    $(function () {
        $('.js-custom__checkbox').change(function () {
            var container  = $(this).closest('.js-custom__container');
            var toggles     = container.find('.js-custom__toggle');
            toggles.toggle();
        });
    });
</script>
{% endblock %}